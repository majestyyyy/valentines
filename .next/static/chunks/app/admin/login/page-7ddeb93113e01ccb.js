(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[920],{1805:function(e,t,r){Promise.resolve().then(r.bind(r,1997))},1997:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return c}});var n=r(3827),s=r(4090),i=r(5922),o=r(7907);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(7461).Z)("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);var l=r(684),d=r(933);function c(){let[e,t]=(0,s.useState)("login"),[r,c]=(0,s.useState)(""),[u,m]=(0,s.useState)(""),[h,f]=(0,s.useState)(!1),[x,g]=(0,s.useState)(""),p=(0,o.useRouter)(),b=async e=>{e.preventDefault(),f(!0),g("");try{let{error:e}=await i.O.auth.signInWithOtp({email:r,options:{shouldCreateUser:!0,data:{role:"admin"}}});if(e)throw e;g("OTP sent to your email! Please check your inbox."),t("verify")}catch(e){g(e.message||"Failed to send OTP")}finally{f(!1)}},y=async e=>{e.preventDefault(),f(!0),g("");try{let{error:e}=await i.O.auth.signInWithOtp({email:r,options:{shouldCreateUser:!1}});if(e)throw e;g("OTP sent to your email! Please check your inbox."),t("verify")}catch(e){g(e.message||"Failed to send OTP")}finally{f(!1)}},w=async e=>{e.preventDefault(),f(!0),g("");try{let{data:e,error:t}=await i.O.auth.verifyOtp({email:r,token:u,type:"email"});if(t)throw console.error("OTP Verification Error:",t),t;if(!e.session)throw Error("No session created after verification");if(e.user){console.log("User verified:",e.user.id);let{data:t,error:n}=await i.O.from("profiles").select("role").eq("id",e.user.id).single();if(n){console.log("Profile not found, creating admin profile");let t={id:e.user.id,email:r,role:"admin",status:"approved"},{error:n}=await i.p.from("profiles").insert(t);if(n)throw console.error("Error creating profile:",n),n;console.log("Admin profile created, redirecting..."),p.push("/admin")}else if((null==t?void 0:t.role)==="admin")console.log("Existing admin found, redirecting..."),p.push("/admin");else{console.log("Updating user to admin role");let{error:t}=await i.p.from("profiles").update({role:"admin",status:"approved"}).eq("id",e.user.id);if(t)throw console.error("Error updating role:",t),t;console.log("User promoted to admin, redirecting..."),p.push("/admin")}}else throw Error("No user data returned after verification")}catch(e){console.error("Verification failed:",e),g(e.message||"Invalid or expired OTP code")}finally{f(!1)}};return(0,n.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 flex items-center justify-center p-6",children:(0,n.jsxs)("div",{className:"w-full max-w-md",children:[(0,n.jsxs)("div",{className:"text-center mb-8",children:[(0,n.jsx)("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-ue-red to-red-700 rounded-full mb-4 shadow-2xl",children:(0,n.jsx)(a,{className:"w-12 h-12 text-white"})}),(0,n.jsx)("h1",{className:"text-4xl font-black text-white mb-2",children:"Admin Portal"}),(0,n.jsx)("p",{className:"text-gray-400",children:"yUE Match! Administration"})]}),(0,n.jsx)("div",{className:"bg-white rounded-3xl shadow-2xl p-8",children:"verify"===e?(0,n.jsxs)("form",{onSubmit:w,className:"space-y-6",children:[(0,n.jsxs)("div",{className:"text-center mb-6",children:[(0,n.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mb-3",children:(0,n.jsx)(l.Z,{className:"w-8 h-8 text-green-600"})}),(0,n.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Check Your Email"}),(0,n.jsxs)("p",{className:"text-sm text-gray-500",children:["We sent an 8-digit code to ",(0,n.jsx)("strong",{children:r})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"otp",className:"block text-sm font-bold text-gray-700 mb-2",children:"Enter OTP Code"}),(0,n.jsx)("input",{type:"text",id:"otp",className:"w-full rounded-xl border-2 border-gray-200 px-4 py-4 focus:border-ue-red focus:outline-none transition-colors text-center text-2xl font-bold tracking-widest",placeholder:"00000000",value:u,onChange:e=>m(e.target.value.replace(/\D/g,"").slice(0,8)),maxLength:8,required:!0})]}),x&&(0,n.jsx)("div",{className:"p-4 rounded-xl text-sm font-medium ".concat(x.includes("sent")?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"),children:x}),(0,n.jsxs)("button",{type:"submit",disabled:h||8!==u.length,className:"w-full rounded-full bg-gradient-to-r from-ue-red to-red-700 px-6 py-4 text-base font-bold text-white shadow-xl hover:shadow-2xl focus:outline-none disabled:opacity-50 transition-all active:scale-95 flex items-center justify-center gap-2",children:[(0,n.jsx)(d.Z,{className:"w-5 h-5"}),h?"Verifying...":"Verify & Sign In"]}),(0,n.jsx)("button",{type:"button",onClick:()=>{t("login"),m(""),g("")},className:"w-full text-sm text-gray-500 hover:text-ue-red transition-colors",children:"← Back to login"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex gap-2 mb-6 bg-gray-100 rounded-xl p-1",children:[(0,n.jsx)("button",{type:"button",onClick:()=>t("login"),className:"flex-1 py-2 px-4 font-bold rounded-lg transition-all ".concat("login"===e?"bg-white text-ue-red shadow-sm":"text-gray-500"),children:"Login"}),(0,n.jsx)("button",{type:"button",onClick:()=>t("signup"),className:"flex-1 py-2 px-4 font-bold rounded-lg transition-all ".concat("signup"===e?"bg-white text-ue-red shadow-sm":"text-gray-500"),children:"Sign Up"})]}),(0,n.jsxs)("form",{onSubmit:"signup"===e?b:y,className:"space-y-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"email",className:"block text-sm font-bold text-gray-700 mb-2",children:"Admin Email"}),(0,n.jsx)("input",{type:"email",id:"email",className:"w-full rounded-xl border-2 border-gray-200 px-4 py-4 focus:border-ue-red focus:outline-none transition-colors text-base",placeholder:"admin@ue.edu.ph",value:r,onChange:e=>c(e.target.value),required:!0})]}),x&&(0,n.jsx)("div",{className:"p-4 rounded-xl text-sm font-medium ".concat(x.includes("sent")?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"),children:x}),(0,n.jsxs)("button",{type:"submit",disabled:h,className:"w-full rounded-full bg-gradient-to-r from-ue-red to-red-700 px-6 py-4 text-base font-bold text-white shadow-xl hover:shadow-2xl focus:outline-none disabled:opacity-50 transition-all active:scale-95 flex items-center justify-center gap-2",children:[(0,n.jsx)(l.Z,{className:"w-5 h-5"}),h?"Sending OTP...":"signup"===e?"Sign Up with OTP":"Login with OTP"]})]})]})}),(0,n.jsxs)("div",{className:"text-center text-sm text-gray-400 mt-6 space-y-2",children:[(0,n.jsx)("p",{children:"✉️ OTP will be sent to your email"}),(0,n.jsx)("p",{children:"This area is restricted to authorized administrators only."})]})]})})}},5922:function(e,t,r){"use strict";r.d(t,{O:function(){return a},p:function(){return d}});var n=r(7688),s=r(9079);let i=s.env.NEXT_PUBLIC_SUPABASE_URL,o=s.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,a=(0,n.eI)(i,o),l=s.env.NEXT_PUBLIC_SUPABASE_SERVICE_ROLE_KEY||o,d=(0,n.eI)(i,l,{auth:{autoRefreshToken:!1,persistSession:!1}})},7461:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});var n=r(4090),s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),o=(e,t)=>{let r=(0,n.forwardRef)((r,o)=>{let{color:a="currentColor",size:l=24,strokeWidth:d=2,absoluteStrokeWidth:c,className:u="",children:m,...h}=r;return(0,n.createElement)("svg",{ref:o,...s,width:l,height:l,stroke:a,strokeWidth:c?24*Number(d)/Number(l):d,className:["lucide","lucide-".concat(i(e)),u].join(" "),...h},[...t.map(e=>{let[t,r]=e;return(0,n.createElement)(t,r)}),...Array.isArray(m)?m:[m]])});return r.displayName="".concat(e),r}},933:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(7461).Z)("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]])},684:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(7461).Z)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},7907:function(e,t,r){"use strict";var n=r(5313);r.o(n,"useParams")&&r.d(t,{useParams:function(){return n.useParams}}),r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})}},function(e){e.O(0,[667,971,69,744],function(){return e(e.s=1805)}),_N_E=e.O()}]);