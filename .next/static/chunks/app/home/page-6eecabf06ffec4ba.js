(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[951],{137:function(e,t,s){Promise.resolve().then(s.bind(s,5231))},5231:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return c}});var l=s(3827),a=s(4090),r=s(5922),i=s(5211),n=s(2235),o=s(8792),d=s(7907);function c(){var e,t,s,c,u;let h=(0,d.useRouter)(),[m,f]=(0,a.useState)([]),[x,p]=(0,a.useState)(null),[b,g]=(0,a.useState)(null),[v,w]=(0,a.useState)(0),[j,N]=(0,a.useState)(null),[y,_]=(0,a.useState)(!0),[k,S]=(0,a.useState)(0),[P,O]=(0,a.useState)([]);(0,a.useEffect)(()=>{E(),C()},[]),(0,a.useEffect)(()=>{if(!j)return;let e=j.id,t=r.O.channel("profiles-changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"profiles"},t=>{let s=t.new;"approved"!==s.status||s.id===e||P.includes(s.id)||(console.log("New approved profile detected:",s),f(e=>[...e,s]),x||(p(s),w(0)))}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"profiles"},t=>{let s=t.new;"approved"!==s.status||s.id===e||P.includes(s.id)||(console.log("Profile approved in real-time:",s),f(e=>e.some(e=>e.id===s.id)?e:[...e,s]),x||(p(s),w(0)))}).subscribe(),s=r.O.channel("matches-updates").on("postgres_changes",{event:"INSERT",schema:"public",table:"matches"},t=>{let s=t.new;(s.user1_id===e||s.user2_id===e)&&C()}).subscribe();return()=>{r.O.removeChannel(t),r.O.removeChannel(s)}},[j,x,P]);let E=async()=>{let{data:{user:e}}=await r.O.auth.getUser();if(!e){h.push("/");return}let{data:t}=await r.O.from("profiles").select("*").eq("id",e.id).single();if(!t){h.push("/profile-setup");return}if("pending"===t.status){h.push("/profile-setup/pending");return}if("rejected"===t.status){h.push("/profile-setup?rejected=true");return}if("approved"!==t.status){h.push("/");return}N(t),await M(e.id,t),_(!1)},C=async()=>{let{data:{user:e}}=await r.O.auth.getUser();if(!e)return;let{data:t}=await r.O.from("matches").select("*").or("user1_id.eq.".concat(e.id,",user2_id.eq.").concat(e.id));S((null==t?void 0:t.length)||0)},M=async(e,t)=>{let{data:s}=await r.O.from("swipes").select("swiped_id").eq("swiper_id",e),l=(null==s?void 0:s.map(e=>e.swiped_id))||[];l.push(e),O(l),console.log("Fetching candidates for:",e),console.log("My profile:",t);let{count:a}=await r.O.from("profiles").select("*",{count:"exact",head:!0}).eq("status","approved");console.log("Total approved profiles in DB:",a);let i="(".concat(l.map(e=>'"'.concat(e,'"')).join(","),")"),n=r.O.from("profiles").select("*").eq("status","approved").filter("id","not.in",i).limit(10),{data:o,error:d}=await n;d&&console.error("Error fetching candidates:",d),console.log("Candidates found:",null==o?void 0:o.length,o),o&&o.length>0?(f(o),p(o[0]),w(0)):(console.log("No candidates found matching criteria."),f([]),p(null))},U=async e=>{if(!x)return;let{data:{user:t}}=await r.O.auth.getUser();if(!t)return;O(e=>[...e,x.id]);let s=m.slice(1);f(s),p(s.length>0?s[0]:null),w(0);let l=r.O.from("swipes").insert({swiper_id:t.id,swiped_id:x.id,direction:e});if("right"===e){let e=r.O.from("swipes").select("*").eq("swiper_id",x.id).eq("swiped_id",t.id).eq("direction","right").single(),[,{data:s}]=await Promise.all([l,e]);s&&(await r.O.from("matches").insert({user1_id:t.id,user2_id:x.id}),g(x))}else await l};return b?(0,l.jsxs)("div",{className:"fixed inset-0 z-50 bg-gradient-to-br from-ue-red/20 via-pink-500/20 to-purple-500/20 backdrop-blur-md flex flex-col items-center justify-center p-8 text-white overflow-hidden",children:[(0,l.jsx)("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[...Array(20)].map((e,t)=>(0,l.jsx)(i.Z,{className:"absolute text-ue-red fill-ue-red opacity-30 animate-float",style:{left:"".concat(100*Math.random(),"%"),top:"".concat(100*Math.random(),"%"),width:"".concat(30*Math.random()+20,"px"),height:"".concat(30*Math.random()+20,"px"),animationDelay:"".concat(3*Math.random(),"s"),animationDuration:"".concat(3*Math.random()+4,"s")}},t))}),(0,l.jsxs)("div",{className:"relative z-10 max-w-md w-full",children:[(0,l.jsx)("h1",{className:"text-5xl font-black text-ue-red mb-8 text-center drop-shadow-lg animate-pulse",children:"IT'S A MATCH!"}),(0,l.jsxs)("div",{className:"flex gap-6 items-center justify-center mb-8",children:[(0,l.jsx)("div",{className:"relative",children:(0,l.jsx)("div",{className:"w-28 h-28 rounded-full overflow-hidden border-4 border-white shadow-2xl bg-gray-300",children:(null==j?void 0:null===(t=j.photo_urls)||void 0===t?void 0:t[0])?(0,l.jsx)("img",{src:j.photo_urls[0],alt:"You",className:"w-full h-full object-cover"}):(0,l.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-400 to-gray-500 text-white text-3xl font-bold",children:(null==j?void 0:null===(s=j.nickname)||void 0===s?void 0:s[0])||"Y"})})}),(0,l.jsx)(i.Z,{className:"text-ue-red fill-ue-red w-12 h-12 animate-bounce"}),(0,l.jsx)("div",{className:"relative",children:(0,l.jsx)("div",{className:"w-28 h-28 rounded-full overflow-hidden border-4 border-white shadow-2xl bg-gray-300",children:(null===(c=b.photo_urls)||void 0===c?void 0:c[0])?(0,l.jsx)("img",{src:b.photo_urls[0],alt:b.nickname||"Match",className:"w-full h-full object-cover"}):(0,l.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-400 to-gray-500 text-white text-3xl font-bold",children:(null===(u=b.nickname)||void 0===u?void 0:u[0])||"M"})})})]}),(0,l.jsxs)("p",{className:"text-center text-xl mb-10 text-white drop-shadow-md font-medium",children:["You and ",(0,l.jsx)("span",{className:"font-bold text-ue-red",children:b.nickname})," liked each other!"]}),(0,l.jsxs)("div",{className:"flex flex-col w-full gap-4",children:[(0,l.jsx)(o.default,{href:"/chat",className:"w-full bg-ue-red hover:bg-red-700 py-4 rounded-full text-center font-bold text-lg shadow-xl transition-all hover:scale-105",children:"Send a Message"}),(0,l.jsx)("button",{onClick:()=>g(null),className:"w-full bg-white/20 backdrop-blur-sm border-2 border-white hover:bg-white/30 py-4 rounded-full font-bold text-lg transition-all hover:scale-105",children:"Keep Swiping"})]})]})]}):y?(0,l.jsx)("div",{className:"h-[100dvh] flex items-center justify-center bg-gradient-to-b from-gray-50 to-gray-100",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-ue-red border-t-transparent mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-gray-500 font-medium",children:"Loading profiles..."})]})}):(0,l.jsxs)("div",{className:"h-[100dvh] flex flex-col bg-gradient-to-br from-pink-100 via-rose-50 to-red-50 overflow-hidden",children:[(0,l.jsxs)("header",{className:"flex items-center justify-between px-6 py-4 bg-gradient-to-r from-pink-500 to-red-500 shadow-lg z-40",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(i.Z,{className:"w-7 h-7 text-white fill-white"}),(0,l.jsx)("h1",{className:"text-xl font-black text-white drop-shadow-md",children:"yUE Match!"})]}),(0,l.jsx)("div",{className:"flex items-center gap-2",children:(0,l.jsxs)(o.default,{href:"/chat",className:"relative p-2 hover:bg-white/20 rounded-full transition-colors group",children:[(0,l.jsx)(i.Z,{className:"w-6 h-6 text-white fill-white group-hover:scale-110 transition-transform"}),k>0&&(0,l.jsx)("span",{className:"absolute -top-1 -right-1 bg-gradient-to-r from-ue-red to-pink-600 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center shadow-lg animate-pulse",children:k>9?"9+":k})]})})]}),(0,l.jsx)("main",{className:"flex-1 relative overflow-hidden",children:x?(0,l.jsxs)("div",{className:"relative h-full w-full max-w-lg mx-auto",children:[(0,l.jsxs)("div",{className:"absolute inset-4 bg-white rounded-3xl shadow-2xl overflow-hidden",children:[x.photo_urls&&x.photo_urls.length>1&&(0,l.jsx)("div",{className:"absolute top-3 left-3 right-3 flex gap-2 z-20",children:x.photo_urls.map((e,t)=>(0,l.jsx)("div",{className:"h-1 flex-1 rounded-full transition-all ".concat(t===v?"bg-white shadow-lg":"bg-white/40")},t))}),(0,l.jsxs)("div",{className:"absolute inset-0 z-10 flex",children:[(0,l.jsx)("button",{className:"w-1/2 h-full focus:outline-none active:bg-black/5",onClick:()=>w(e=>Math.max(0,e-1))}),(0,l.jsx)("button",{className:"w-1/2 h-full focus:outline-none active:bg-black/5",onClick:()=>w(e=>{var t;return Math.min(((null===(t=x.photo_urls)||void 0===t?void 0:t.length)||1)-1,e+1)})})]}),(0,l.jsxs)("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-200 to-gray-300",children:[(null===(e=x.photo_urls)||void 0===e?void 0:e[v])?(0,l.jsx)("img",{src:x.photo_urls[v],alt:x.nickname||"Profile",className:"w-full h-full object-cover"}):(0,l.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center text-gray-400",children:[(0,l.jsx)(i.Z,{className:"w-20 h-20 mb-2 opacity-20"}),(0,l.jsx)("p",{className:"text-sm",children:"No Photo"})]}),(0,l.jsx)("div",{className:"absolute inset-x-0 bottom-0 h-2/3 bg-gradient-to-t from-black/90 via-black/40 to-transparent pointer-events-none"})]}),(0,l.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 p-6 pb-24 text-white z-20 pointer-events-none",children:[(0,l.jsx)("div",{className:"flex justify-between items-start mb-3",children:(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("h2",{className:"text-3xl font-bold drop-shadow-lg",children:[x.nickname,(0,l.jsx)("span",{className:"text-2xl font-normal ml-2",children:x.year_level})]}),(0,l.jsxs)("p",{className:"text-lg opacity-95 mt-1 flex items-center gap-2",children:[(0,l.jsx)("span",{className:"font-medium",children:x.college}),x.gender&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"opacity-50",children:"â€¢"}),(0,l.jsx)("span",{className:"text-base opacity-75",children:x.gender})]})]})]})}),x.description&&(0,l.jsx)("p",{className:"text-sm opacity-90 mb-3 line-clamp-2 drop-shadow",children:x.description}),x.hobbies&&x.hobbies.length>0&&(0,l.jsx)("div",{className:"flex flex-wrap gap-2",children:x.hobbies.slice(0,4).map((e,t)=>(0,l.jsx)("span",{className:"bg-white/25 backdrop-blur-sm text-xs px-3 py-1.5 rounded-full border border-white/20 font-medium",children:e},t))})]}),(0,l.jsx)("button",{onClick:e=>{e.stopPropagation();let t=prompt("Why are you reporting this user?");t&&r.O.from("reports").insert({reporter_id:r.O.auth.getUser().id,reported_id:x.id,reason:t}).then(()=>alert("Report submitted"))},className:"absolute top-4 right-4 z-30 pointer-events-auto text-xs text-white/70 bg-black/20 backdrop-blur-sm border border-white/20 px-3 py-1.5 rounded-full hover:bg-black/30 transition-colors",children:"Report"})]}),(0,l.jsxs)("div",{className:"absolute bottom-8 left-0 right-0 flex justify-center items-center gap-6 z-30",children:[(0,l.jsx)("button",{onClick:()=>U("left"),className:"w-16 h-16 bg-white rounded-full shadow-xl flex items-center justify-center text-red-500 hover:scale-110 active:scale-95 transition-transform border-2 border-gray-100",children:(0,l.jsx)(n.Z,{size:32,strokeWidth:2.5})}),(0,l.jsx)("button",{onClick:()=>U("right"),className:"w-20 h-20 bg-ue-red rounded-full shadow-xl flex items-center justify-center text-white hover:scale-110 active:scale-95 transition-transform",children:(0,l.jsx)(i.Z,{size:36,fill:"currentColor",strokeWidth:0})})]})]}):(0,l.jsx)("div",{className:"h-full flex flex-col items-center justify-center text-center px-8",children:(0,l.jsxs)("div",{className:"bg-white rounded-3xl p-12 shadow-xl max-w-sm",children:[(0,l.jsx)(i.Z,{className:"w-20 h-20 mx-auto mb-6 text-ue-red opacity-20"}),(0,l.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"No More Profiles"}),(0,l.jsx)("p",{className:"text-gray-500",children:"Check back later for new matches!"})]})})})]})}},5922:function(e,t,s){"use strict";s.d(t,{O:function(){return n},p:function(){return d}});var l=s(7688),a=s(9079);let r=a.env.NEXT_PUBLIC_SUPABASE_URL,i=a.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,n=(0,l.eI)(r,i),o=a.env.NEXT_PUBLIC_SUPABASE_SERVICE_ROLE_KEY||i,d=(0,l.eI)(r,o,{auth:{autoRefreshToken:!1,persistSession:!1}})},2235:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(7461).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},7907:function(e,t,s){"use strict";var l=s(5313);s.o(l,"useParams")&&s.d(t,{useParams:function(){return l.useParams}}),s.o(l,"usePathname")&&s.d(t,{usePathname:function(){return l.usePathname}}),s.o(l,"useRouter")&&s.d(t,{useRouter:function(){return l.useRouter}}),s.o(l,"useSearchParams")&&s.d(t,{useSearchParams:function(){return l.useSearchParams}})}},function(e){e.O(0,[667,804,971,69,744],function(){return e(e.s=137)}),_N_E=e.O()}]);